<header>
  <nav class="navbar navbar-default top-navbar navbar-fixed-top">
    <div class="left_logo navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
        data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
     <a class="navbar-brand" href="/">
       <i class="glyphicon glyphicon-random"></i>
       <strong>Here</strong>
     </a>
     <div id="sideNav" href="" class="">
       <i class="glyphicon glyphicon-indent-left"></i>
     </div>
    </div>
    <div class="right_user_message collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <% if(login){ %>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
          aria-haspopup="true" aria-expanded="false"><span class="fa fa-tasks fa-fw"></span> <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/add_exchange_product"><span class="glyphicon glyphicon-sort"></span> <span>我要换</span></a></li>
            <li role="separator" class="divider"></li>
            <li><a href="/add_sale_product"><span class="glyphicon glyphicon-usd"></span> <span>我要卖</span></a></li>
            <li role="separator" class="divider"></li>
            <li><a href="/add_donate_product"><span class="glyphicon glyphicon-retweet"></span> <span>我要捐</span></a></li>
            <li role="separator" class="divider"></li>
            <li><a href="/add_send_product"><span class="glyphicon glyphicon-new-window"></span> <span>我要赠</span></a></li>
            <li role="separator" class="divider"></li>
            <li><a href="/" id="user_exit"><span class="glyphicon glyphicon-remove-sign"></span> <span>退出</span></a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
          aria-haspopup="true" aria-expanded="false"><span class="fa fa-bell fa-fw"></span> <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/"><span class="glyphicon glyphicon-export"></span> <span>所有统计</span></a></li>
            <li role="separator" class="divider"></li>
            <li><a href="/usercenter"><span class="glyphicon glyphicon-send"></span> <span>个人中心</span></a></li>
            <li role="separator" class="divider"></li>
            <li><a href="#"><span class="glyphicon glyphicon-user"></span> <span>help</span></a></li>
          </ul>
        </li>
        <li class="dropdown userMessages" >
          <a href="" class="dropdown-toggle">
            <img src="/avatar/default.jpg" alt="img" class="avatar_img" id="userimg"/>
            <span id="username"><%= username%></span>
          </a>
        </li>
        <%} else{%>
          <li>
              <button type="button" class="btn btn-success header-login" data-toggle="modal" data-target="#myModalLogin">登陆</button>
              <!-- Modal -->
              <div class="modal fade" id="myModalLogin" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                      <h4 class="modal-title" id="myModalLabel">欢迎登陆</h4>
                    </div>
                    <div class="modal-body">
                      <form>
                          <div class="form-group">
                            <label for="loginEmail">输入邮箱</label>
                            <input type="email" class="form-control" id="loginEmail" placeholder="邮箱地址">
                          </div>
                          <div class="form-group">
                            <label for="loginPassword">输入密码</label>
                            <input type="password" class="form-control" id="loginPassword" placeholder="6-8位数字或字母">
                          </div>
                          <button type="submit" class="btn btn-info" id="login-submit">登陆</button>
                      </form>
                      <div class="alert alert-danger" role="alert" id="login_error_cue" style="display: none">
                             此名字已经被注册，请重新选择
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                  </div>
                </div>
              </div>
              <button type="button" class="btn btn-info header-regist" data-toggle="modal" data-target="#myModalRegist">注册</button>
              <!-- Modal -->
              <div class="modal fade" id="myModalRegist" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                      <h4 class="modal-title" id="myModalLabel">欢迎注册</h4>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="form-group">
                              <label for="userEmail">输入邮箱</label> <span class="validate_username"></span>
                              <input type="email" class="form-control" id="userEmail" placeholder="邮箱地址">
                            </div>
                            <div class="form-group">
                              <label for="userPassword">输入密码</label> <span class="validate_userpwd"></span>
                              <input type="password" class="form-control" id="userPassword" placeholder="6-8位数字或字母">
                            </div>
                            <div class="checkbox">
                              <label>
                                <input type="checkbox" class="regist_checked"> 同意本站的各项协议
                              </label>
                            </div>
                            <button type="submit" class="btn btn-info disabled" id="regist-submit">注册</button>
                        </form>
                        <div class="alert alert-danger" role="alert" id="error_cue" style="display: none">
                					     此名字已经被注册，请重新选择
                				</div>
                    </div>
                  </div>
                </div>
              </div>
          </li>
          <% }%>
      </ul>
    </div>
  </nav>
</header>
<script type="text/javascript" src="/js/jquery-1.10.2.js"></script>
  <!-- 注册业务 -->
<script>
	  $("input").focus(function(){
	    	$("#error_cue").fadeOut();
	    	$(".validate_username").fadeOut();
	    	$(".validate_userpwd").fadeOut();
	    });
		$("#regist-submit").click(function (argument) {
			var username = $("#userEmail").val();
			var userpassword = $("#userPassword").val();
			var patrn=/^(\w){6,20}$/;
      var emailPatrn = /^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/;

			if(!emailPatrn.test(username)) {
				$(".validate_username").html("输入正确邮箱").fadeIn();
			}else if(username !=""){
				if(patrn.test(userpassword)) {
					$.post("/doRegist",{
						"username" : username,
						"userpassword" : userpassword
					},function(result){
						if(result　==　"1"){
							alert("注册成功，将自动回到首页");
							window.location="/";
						}else if(result　==　"-1"){
							$("#error_cue").fadeIn();
						}else if(result　==　"-3") {
							alert("服务器错误，请联系管理员");
						}
					})
				}else{
					$(".validate_userpwd").html("请正确输入密码").fadeIn();
					return false;
				}

			}

			return false;//组织表单自动提交，或者提交按钮不用 type="submit"
		})
	</script>

  <!-- 登陆业务 -->
<script>
		$("#login-submit").click(function () {
			$.post("/doLogin",{
				"username" : $("#loginEmail").val(),
				"userpassword" : $("#loginPassword").val(),
			},function(result){
        if(result=="1"){
					alert("登录成功,将回到首页");
					// window.location = "/";
          window.location = "/";
				}else if(result=="-1"){
					$("#login_error_cue").fadeIn().html("用户名不存在");
				}else if(result=="-5"){
					$("#login_error_cue").fadeIn().html("服务器错误");
				}
				else if(result=="-2"){
					$("#login_error_cue").fadeIn().html("密码错误");
				}
			})
			return false;
		})
	</script>

<!-- 退出 -->
<script type="text/javascript">
  $("#user_exit").click(function() {
    $.get("/user_exit",{},function(result){
  				if(result=='-1') {
					 	console.log("exit");
  				}
		})
  })
</script>
